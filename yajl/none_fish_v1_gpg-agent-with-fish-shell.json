[
    "# Start or re-use a gpg-agent.",
    "#",
    "# Assumes gpg-agent writes its environment info in ~/.gpg-agent-info.",
    "#",
    "# Sets the gpg-agent environment stuff as universal variables, so it",
    "# takes effect across all shells.",
    "",
    "function __refresh_gpg_agent_info -d \"Re-load ~/.gpg-agent-info into environment\"",
    "\tcat ~/.gpg-agent-info | sed 's/=/ /' | while read key value",
    "\t\tset -e $key",
    "\t\tset -U -x $key \"$value\"",
    "\tend",
    "end",
    "",
    "if not set -q -x GPG_AGENT_INFO",
    "\tgpg-agent --daemon >/dev/null",
    "end",
    "",
    "if test -f ~/.gpg-agent-info",
    "\t__refresh_gpg_agent_info",
    "end"
]
